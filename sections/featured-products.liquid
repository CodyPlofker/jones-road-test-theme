<div class="featured-products featured-products-reviews-{{ section.settings.reviews_display | replace: ' ', '-' | downcase | remove: '&' }}" style="background: {{ section.settings.background }};
  --color: {{ section.settings.color }}; 
  --color-mobile: {{ section.settings.color_mobile }};
  --fontfamily: 
  {% if section.settings.fontfamily == 'RingsideWideWeb' %}
    'RingsideWideWeb', 'Helvetica', 'Arial', sans-serif
  {% elsif section.settings.fontfamily == 'GeogrotesqueCondBoldWeb' %}
    'GeogrotesqueCondBoldWeb', 'Arial Black', 'Impact', sans-serif
  {% elsif section.settings.fontfamily == 'BaseMonoWideWeb' %}
    'BaseMonoWideWeb', 'Courier', 'Courier New', sans-serif
  {% elsif section.settings.fontfamily == 'Canela' %}
   'Canela', serif
  {% elsif section.settings.fontfamily == 'FontSpringArticulateDemibold' %}
    'FontSpringArticulateDemibold', sans-serif
  {% elsif section.settings.fontfamily == 'ArticulatCF' %}
    'ArticulatCF', 'GeogrotesqueCondBoldWeb', 'Arial Black', 'Impact', sans-serif
  {% endif %}
  ;
  --fontfamily-mobile: 
  {% if section.settings.fontfamily_mobile == 'RingsideWideWeb' %}
    'RingsideWideWeb', 'Helvetica', 'Arial', sans-serif
  {% elsif section.settings.fontfamily_mobile == 'GeogrotesqueCondBoldWeb' %}
    'GeogrotesqueCondBoldWeb', 'Arial Black', 'Impact', sans-serif
  {% elsif section.settings.fontfamily_mobile == 'BaseMonoWideWeb' %}
    'BaseMonoWideWeb', 'Courier', 'Courier New', sans-serif
  {% elsif section.settings.fontfamily_mobile == 'Canela' %}
    'Canela', serif
  {% elsif section.settings.fontfamily_mobile == 'FontSpringArticulateDemibold' %}
    'FontSpringArticulateDemibold', sans-serif
  {% elsif section.settings.fontfamily_mobile == 'ArticulatCF' %}
    'ArticulatCF', 'GeogrotesqueCondBoldWeb', 'Arial Black', 'Impact', sans-serif
  {% endif %}
  ;
  --font-weight: {{ section.settings.font_weight }};
  --font-weight-mobile: {{ section.settings.font_weight_mobile }};
  --letter-spacing: {{ section.settings.letter_spacing }};
  --letter-spacing-mobile: {{ section.settings.letter_spacing_mobile }};
  --desktop-fontsize: {{ section.settings.desktop_fontsize }}px;
  --mobile-fontsize: {{ section.settings.mobile_fontsize }}px;
  ">
  {%- include 'section-header' with 
    heading: section.settings.heading,
    cta_text: section.settings.cta_text,
    cta_link: section.settings.cta_link,
    background: section.settings.background
  -%}
  <div class="featured-products__grid" data-count="{{ section.blocks.size }}">
    {%- for block in section.blocks -%}
      {%- assign prod = all_products[block.settings.product] -%}

      {% if prod == blank %}
        {% continue %}
      {% endif %}
      
      {%- comment -%} Check if product should be shown in current region {%- endcomment -%}
      {%- assign show_in_region = true -%}
      {%- if block.settings.region_specific == true -%}
        {%- assign current_currency = localization.country.currency.iso_code -%}
        {%- assign allowed_regions = block.settings.allowed_regions | strip | upcase -%}
        {%- assign show_in_region = false -%}
        
        {%- if allowed_regions == blank or allowed_regions == "ALL" -%}
          {%- assign show_in_region = true -%}
        {%- else -%}
          {%- assign region_array = allowed_regions | split: "," -%}
          {%- for region in region_array -%}
            {%- assign clean_region = region | strip -%}
            {%- if clean_region == current_currency -%}
              {%- assign show_in_region = true -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endif -%}
      
      {%- comment -%} Skip this product if not allowed in current region {%- endcomment -%}
      {%- unless show_in_region -%}
        {%- continue -%}
      {%- endunless -%}
      
      {% liquid
        assign compliance_product_title = null
        assign current_country_product = null
        assign compliance_products = prod.metafields.custom.compliance_products.value
        if compliance_products
          assign compliance_product_title = compliance_products.product_title
          assign iso_code = localization.country.currency.iso_code
          case iso_code
            when "USD"
              assign current_country_product = compliance_products.usa_product.value
            when "CAD"
              assign current_country_product = compliance_products.canada_product.value
            when "GBP"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "EUR"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "BGN"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "CZK"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "DKK"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "HUF"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "PLN"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "RON"
              assign current_country_product = compliance_products.eu_uk_product.value
            when "SEK"
              assign current_country_product = compliance_products.eu_uk_product.value
          endcase
        endif
      %}

      {%- if block.settings.image != blank -%}
        {%- assign img = block.settings.image -%}
      {%- else -%}
        {%- assign img = prod.featured_image -%}
      {%- endif -%}
      
      {% if compliance_products %}
        {% if current_country_product.id == prod.id %}
          {%- include 'product-card' with 
            product: prod,
            card_image_override: img,
            hide_button: true,
            compliance_product_title: compliance_product_title
          -%}
        {% else %}
          {% continue %}
        {% endif %}
      {% else %}
      {%- include 'product-card' with 
        product: prod,
        card_image_override: img,
        hide_button: true
      -%}
      {% endif %}
    {% endfor %}
  </div>
</div>

{% schema %}
  {
    "name": "Featured Products",
    "max_blocks": 8,
    "class": "featured-products__section",
    "settings": [
      {
        "type": "header",
        "content": "Settings"
      },
      {
        "type": "color",
        "id": "background",
        "label": "Background Color",
        "default": "#ffffff"
      },
      {
        "type": "header",
        "content": "Content"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Bestsellers"
      },
      {
        "type": "color",
        "label": "Color",
        "id": "color",
        "default": "#000000"
      },
      {
        "type": "color",
        "label": "Color (Mobile)",
        "id": "color_mobile",
        "default": "#000000"
      },
      {
        "type": "select",
        "id": "fontfamily",
        "label": "Font Family",
        "options": [
          {
            "value": "RingsideWideWeb",
            "label": "RingsideWideWeb"
          },
          {
            "value": "GeogrotesqueCondBoldWeb",
            "label": "GeogrotesqueCondBoldWeb"
          },
          {
            "value": "BaseMonoWideWeb",
            "label": "BaseMonoWideWeb"
          },
          {
            "value": "Canela",
            "label": "Canela"
          },
          {
            "value": "FontSpringArticulateDemibold",
            "label": "FontSpringArticulateDemibold"
          },
          {
            "value": "ArticulatCF",
            "label": "ArticulatCF"
          }
        ],
        "default": "FontSpringArticulateDemibold"
      },
      {
        "type": "select",
        "id": "fontfamily_mobile",
        "label": "Font Family (Mobile)",
        "options": [
          {
            "value": "RingsideWideWeb",
            "label": "RingsideWideWeb"
          },
          {
            "value": "GeogrotesqueCondBoldWeb",
            "label": "GeogrotesqueCondBoldWeb"
          },
          {
            "value": "BaseMonoWideWeb",
            "label": "BaseMonoWideWeb"
          },
          {
            "value": "Canela",
            "label": "Canela"
          },
          {
            "value": "FontSpringArticulateDemibold",
            "label": "FontSpringArticulateDemibold"
          },
          {
            "value": "ArticulatCF",
            "label": "ArticulatCF"
          }
        ],
        "default": "FontSpringArticulateDemibold"
      },
      {
        "type": "range",
        "id": "font_weight",
        "label": "Font Weight",
        "min": 100,
        "max": 900,
        "default": 700,
        "step": 100
      },
      {
        "type": "range",
        "id": "font_weight_mobile",
        "label": "Font Weight (Mobile)",
        "min": 100,
        "max": 900,
        "default": 700,
        "step": 100
      },
      {
        "type": "text",
        "id": "letter_spacing",
        "label": "Letter Spacing",
        "default": "0.3px"
      },
      {
        "type": "text",
        "id": "letter_spacing_mobile",
        "label": "Letter Spacing (Mobile)",
        "default": "0.3px"
      },
      {
        "type": "range",
        "id": "desktop_fontsize",
        "label": "Font Size",
        "min": 1,
        "max": 100,
        "default": 16,
        "unit": "px"
      },
      {
        "type": "range",
        "id": "mobile_fontsize",
        "label": "Font Size (Mobile)",
        "min": 1,
        "max": 100,
        "default": 13,
        "unit": "px"
      },
      {
        "type": "text",
        "id": "cta_text",
        "label": "CTA Text"
      },
      {
        "type": "url",
        "id": "cta_link",
        "label": "CTA Link"
      },
      {
        "type": "header",
        "content": "Settings"
      },
      {
        "type": "select",
        "id": "reviews_display",
        "label": "Review Stars",
        "options": [
          { "label": "Hidden", "value": "false" },
          { "label": "Mobile Only", "value": "mobile" },
          { "label": "Desktop Only", "value": "desktop" },
          { "label": "Mobile & Desktop", "value": "true" }
        ],
        "default": "mobile"
      }
    ],
    "blocks": [
      {
        "type": "product",
        "name": "Product",
        "settings": [
          {
            "type": "header",
            "content": "Settings"
          },
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          },
          {
            "type": "checkbox",
            "id": "region_specific",
            "label": "Region Specific",
            "info": "Enable to show this product only in selected regions",
            "default": false
          },
          {
              "visible_if": "{{ block.settings.region_specific == true }}",
              "type": "textarea",
              "id": "allowed_regions",
              "label": "Allowed Regions",
              "info": "Enter region codes separated by commas (e.g. 'AUD,NZD' for Australia and New Zealand). Leave empty or enter 'ALL' to show in all regions. Available codes: USD, CAD, GBP, EUR, BGN, CZK, DKK, HUF, PLN, RON, SEK, AUD, NZD",
              "placeholder": "AUD,NZD",
              "default": "ALL"
          },
          {
            "type": "header",
            "content": "Content"
          },
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image",
            "info": "Optional. Will display instead of the product's featured image."
          }
        ]
      }
    ],
    "presets": [{ "name": "Featured Products" }]
  }
{% endschema %}