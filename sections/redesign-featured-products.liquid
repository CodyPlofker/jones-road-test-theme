{%- assign config = section.settings -%}

<section class="redesign-products" style="
  --bg-color: {{ config.background_color }};
  --text-color: {{ config.text_color }};
  --heading-color: {{ config.heading_color }};
">
  <div class="redesign-products__container">
    <div class="redesign-products__header">
      {%- if config.heading != blank -%}
        <h2 class="redesign-products__heading">{{ config.heading }}</h2>
      {%- endif -%}
      {%- if config.cta_text != blank and config.cta_url != blank -%}
        <a href="{{ config.cta_url }}" class="redesign-products__view-all">
          {{ config.cta_text }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      {%- endif -%}
    </div>

    <div class="redesign-products__grid" data-columns="{{ section.blocks.size | at_most: 4 }}">
      {%- for block in section.blocks -%}
        {%- assign product = all_products[block.settings.product] -%}
        {%- if product == blank -%}
          {%- continue -%}
        {%- endif -%}

        <div class="redesign-products__card" {{ block.shopify_attributes }}>
          <a href="{{ product.url }}" class="redesign-products__card-link">
            <div class="redesign-products__card-media">
              {%- if block.settings.image != blank -%}
                <img
                  src="{{ block.settings.image | image_url: width: 500 }}"
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                >
              {%- elsif product.featured_image != blank -%}
                <img
                  src="{{ product.featured_image | image_url: width: 500 }}"
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                >
              {%- else -%}
                <div class="redesign-products__card-placeholder"></div>
              {%- endif -%}

              {%- if block.settings.badge != blank -%}
                <span class="redesign-products__badge">{{ block.settings.badge }}</span>
              {%- endif -%}
            </div>

            <div class="redesign-products__card-content">
              <h3 class="redesign-products__card-title">{{ product.title }}</h3>

              {%- comment -%} Star Rating {%- endcomment -%}
              {%- if config.show_ratings -%}
                <div class="redesign-products__card-rating">
                  <div class="redesign-products__stars">
                    {%- for i in (1..5) -%}
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="#c9a050">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                      </svg>
                    {%- endfor -%}
                  </div>
                  {%- if block.settings.review_count != blank -%}
                    <span class="redesign-products__review-count">({{ block.settings.review_count }})</span>
                  {%- endif -%}
                </div>
              {%- endif -%}

              {%- comment -%} Price - Always Visible {%- endcomment -%}
              <div class="redesign-products__card-price">
                {%- if product.compare_at_price > product.price -%}
                  <span class="redesign-products__price--compare">{{ product.compare_at_price | money }}</span>
                {%- endif -%}
                <span class="redesign-products__price--current">{{ product.price | money }}</span>
              </div>

              {%- comment -%} Variant Count / Shade Info {%- endcomment -%}
              {%- if product.variants.size > 1 -%}
                <span class="redesign-products__card-variants">{{ product.variants.size }} shades</span>
              {%- endif -%}
            </div>
          </a>

          {%- comment -%} Quick Add Button {%- endcomment -%}
          {%- if config.show_quick_add -%}
            <button
              type="button"
              class="redesign-products__quick-add"
              data-product-url="{{ product.url }}"
            >
              Quick Add
            </button>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

<style>
  .redesign-products {
    background: var(--bg-color);
    color: var(--text-color);
    padding: 48px 20px;
  }

  @media (min-width: 768px) {
    .redesign-products {
      padding: 80px 40px;
    }
  }

  .redesign-products__container {
    max-width: 1400px;
    margin: 0 auto;
  }

  .redesign-products__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
    flex-wrap: wrap;
    gap: 16px;
  }

  @media (min-width: 768px) {
    .redesign-products__header {
      margin-bottom: 48px;
    }
  }

  .redesign-products__heading {
    font-family: 'Canela', serif;
    font-size: 28px;
    font-weight: 300;
    color: var(--heading-color);
    margin: 0;
  }

  @media (min-width: 768px) {
    .redesign-products__heading {
      font-size: 40px;
    }
  }

  .redesign-products__view-all {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'ArticulatCF', sans-serif;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    color: var(--text-color);
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: gap 0.3s ease;
  }

  .redesign-products__view-all:hover {
    gap: 12px;
  }

  /* Grid */
  .redesign-products__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  @media (min-width: 768px) {
    .redesign-products__grid {
      gap: 32px;
    }

    .redesign-products__grid[data-columns="3"] {
      grid-template-columns: repeat(3, 1fr);
    }

    .redesign-products__grid[data-columns="4"] {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* Card */
  .redesign-products__card {
    position: relative;
  }

  .redesign-products__card-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .redesign-products__card-media {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
    background: #f5f5f5;
    margin-bottom: 16px;
  }

  .redesign-products__card-media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .redesign-products__card:hover .redesign-products__card-media img {
    transform: scale(1.05);
  }

  .redesign-products__card-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
  }

  .redesign-products__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: #000;
    color: #fff;
    padding: 6px 12px;
    font-family: 'BaseMonoWideWeb', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Content */
  .redesign-products__card-content {
    text-align: center;
  }

  .redesign-products__card-title {
    font-family: 'ArticulatCF', sans-serif;
    font-size: 15px;
    font-weight: 600;
    margin: 0 0 8px;
  }

  @media (min-width: 768px) {
    .redesign-products__card-title {
      font-size: 16px;
    }
  }

  /* Rating */
  .redesign-products__card-rating {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
  }

  .redesign-products__stars {
    display: flex;
    gap: 2px;
  }

  .redesign-products__review-count {
    font-family: 'ArticulatCF', sans-serif;
    font-size: 12px;
    opacity: 0.6;
  }

  /* Price */
  .redesign-products__card-price {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    font-family: 'ArticulatCF', sans-serif;
    font-size: 15px;
    margin-bottom: 4px;
  }

  .redesign-products__price--compare {
    text-decoration: line-through;
    opacity: 0.5;
  }

  .redesign-products__price--current {
    font-weight: 600;
  }

  /* Variants */
  .redesign-products__card-variants {
    font-family: 'BaseMonoWideWeb', monospace;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.6;
  }

  /* Quick Add */
  .redesign-products__quick-add {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    opacity: 0;
    background: #000;
    color: #fff;
    border: none;
    padding: 12px 24px;
    font-family: 'ArticulatCF', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
  }

  .redesign-products__card:hover .redesign-products__quick-add {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .redesign-products__quick-add:hover {
    background: #333;
  }

  @media (max-width: 767px) {
    .redesign-products__quick-add {
      display: none;
    }
  }
</style>

{% schema %}
{
  "name": "Redesign - Featured Products",
  "tag": "section",
  "class": "redesign-products-section",
  "settings": [
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Bestsellers"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "View All Text",
      "default": "Shop All"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "View All URL"
    },
    {
      "type": "header",
      "content": "Settings"
    },
    {
      "type": "checkbox",
      "id": "show_ratings",
      "label": "Show Star Ratings",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Show Quick Add Button",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Custom Image",
          "info": "Optional. Overrides product image."
        },
        {
          "type": "text",
          "id": "badge",
          "label": "Badge Text",
          "info": "E.g., 'Bestseller', 'New', 'Sale'"
        },
        {
          "type": "text",
          "id": "review_count",
          "label": "Review Count",
          "default": "2,450"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Redesign - Featured Products"
    }
  ]
}
{% endschema %}
