{%- assign config = section.settings -%}
{%- assign tabs = section.blocks | map: 'settings' -%}

<div
  id="stepped-tabs-{{ section.id }}"
  class="stepped__tabs js-steppedTabs"
  data-component="steppedTabs"
>
  <div class="stepped__tabs-inner">
    {%- if config.heading != blank -%}
      <h2 class="stepped__tabs-heading">{{ config.heading }}</h2>
    {%- endif -%}
    <div role="tablist" aria-label="Tabs" class="stepped__tabs-tabs">
      <div class="stepped__tabs-buttons">
        {%- for tab in tabs -%}
          <button
            id="{{ tab.name | append: '-button' | handleize }}"
            type="button"
            role="tab"
            tabindex="{%- if forloop.first -%} 0 {%- else -%} -1 {%- endif -%}"
            aria-controls="{{ tab.name | handleize }}"
            aria-selected="{%- if forloop.first -%} true {%- else -%} false {%- endif -%}"
            class="stepped__tabs-button js-steppedTabsButton"
          >
            {{ tab.name }}
          </button>
        {%- endfor -%}
      </div>
      {%- for tab in tabs -%}
        <div 
          id="{{ tab.name | handleize }}"
          role="tabpanel"
          tabindex="{%- if forloop.first -%} 0 {%- else -%} -1 {%- endif -%}"
          aria-labelledby="{{ tab.name | append: '-button' | handleize }}"
          class="stepped__tabs-tab js-steppedTabsTab"
          {% unless forloop.first %} hidden {% endunless %}
        >
          {%- if tab.heading != blank -%}
            <h3 class="stepped__tabs-tab--heading">
              {{ tab.heading }}
            </h3>
          {%- endif -%}
          {%- if tab.steps != blank -%}
            <div class="stepped__tabs-tab--steps text-underline">
              {{ tab.steps }}
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
    {%- if config.subheading != blank or config.description != blank -%}
      <div class="stepped__tabs-bottom">
        {%- if config.subheading != blank -%}
          <h3 class="stepped__tabs-subheading">{{ config.subheading }}</h3>
        {%- endif -%}
        {%- if config.description != blank -%}
          <div class="stepped__tabs-description text-underline">{{ config.description }}</div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>

{%- schema -%}
  {
    "name": "Stepped Tabs",
    "tag": "section",
    "settings": [
      {
        "type": "header",
        "content": "Content"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "text",
        "id": "subheading",
        "label": "Subheading"
      },
      {
        "type": "richtext", // EE
        "id": "description",
        "label": "Description"
      }
    ],
    "blocks": [
      {
        "type": "tab",
        "name": "Tab",
        "settings": [
          {
            "type": "header",
            "content": "Settings"
          },
          {
            "type": "text",
            "id": "name",
            "label": "Name",
            "info": "Displays on the tab button."
          },
          {
            "type": "text",
            "id": "heading",
            "label": "Heading"
          },
          {
            "type": "richtext", // EE
            "id": "steps",
            "label": "Steps",
            "info": "Format the steps as a numbered list. Add each step as a new list item."
          }
        ]
      }
    ],
    "presets": [{ "name": "Stepped Tabs" }]
  }
{%- endschema -%}